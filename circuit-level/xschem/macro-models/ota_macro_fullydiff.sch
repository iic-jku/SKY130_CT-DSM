v {xschem version=3.4.0 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
N -660 80 -660 130 {
lab=vcmi}
N -660 130 -590 130 {
lab=vcmi}
N -590 130 -590 160 {
lab=vcmi}
N -590 130 -520 130 {
lab=vcmi}
N -520 80 -520 130 {
lab=vcmi}
N -590 220 -590 250 {
lab=GND}
N -660 0 -660 20 {
lab=vip}
N -680 0 -660 0 {
lab=vip}
N -520 0 -520 20 {
lab=vin}
N -520 0 -500 0 {
lab=vin}
N -620 30 -590 30 {
lab=vid}
N -590 30 -560 30 {
lab=vid}
N -620 70 -620 90 {
lab=GND}
N -620 90 -590 90 {
lab=GND}
N -590 90 -560 90 {
lab=GND}
N -560 70 -560 90 {
lab=GND}
N 70 680 70 700 {
lab=GND}
N 0 630 30 630 {
lab=#net1}
N 0 670 30 670 {
lab=#net2}
N 70 600 70 620 {
lab=iout}
N -590 90 -590 100 {
lab=GND}
N 120 150 120 200 {
lab=#net3}
N 230 70 230 90 {
lab=voutp1}
N 120 180 200 180 {
lab=#net3}
N 230 150 230 170 {
lab=#net3}
N 230 180 230 210 {
lab=#net3}
N 230 270 230 300 {
lab=voutn1}
N -170 70 -170 110 {
lab=ip1}
N -170 180 -170 190 {
lab=vcmi}
N -740 130 -740 160 {
lab=vcm}
N -740 220 -740 250 {
lab=GND}
N -170 170 -170 180 {
lab=vcmi}
N 230 170 230 180 {
lab=#net3}
N 120 200 120 210 {
lab=#net3}
N 200 180 230 180 {
lab=#net3}
N 200 70 230 70 {
lab=voutp1}
N 200 300 230 300 {
lab=voutn1}
N 120 70 120 90 {
lab=voutp1}
N 120 270 120 300 {
lab=voutn1}
N -280 300 -260 300 {
lab=vip}
N -200 300 -170 300 {
lab=in1}
N -170 300 -130 300 {
lab=in1}
N -280 70 -260 70 {
lab=vin}
N -200 70 -170 70 {
lab=ip1}
N -170 70 -130 70 {
lab=ip1}
N 230 300 350 300 {
lab=voutn1}
N 330 270 330 300 {
lab=voutn1}
N 330 150 330 210 {
lab=#net3}
N 230 180 330 180 {
lab=#net3}
N 230 70 350 70 {
lab=voutp1}
N 330 70 330 90 {
lab=voutp1}
N 120 70 130 70 {
lab=voutp1}
N 190 70 200 70 {
lab=voutp1}
N 120 300 140 300 {
lab=voutn1}
N -130 70 -90 70 {
lab=ip1}
N -130 300 -90 300 {
lab=in1}
N -170 190 -170 210 {
lab=vcmi}
N -170 270 -170 300 {
lab=in1}
N 350 300 450 300 {
lab=voutn1}
N 430 270 430 300 {
lab=voutn1}
N 430 150 430 210 {
lab=sense1}
N 350 70 450 70 {
lab=voutp1}
N 430 70 430 90 {
lab=voutp1}
N 60 510 100 510 {
lab=voutp}
N 60 550 100 550 {
lab=voutn}
N -260 570 -240 570 {
lab=vip}
N -260 490 -240 490 {
lab=vin}
N 160 510 190 510 {
lab=vcm}
N 190 510 190 550 {
lab=vcm}
N 160 550 190 550 {
lab=vcm}
N 190 530 210 530 {
lab=vcm}
N 0 750 0 770 {
lab=GND}
N 0 670 0 690 {
lab=#net2}
N -90 750 -90 770 {
lab=GND}
N -90 670 -90 690 {
lab=#net1}
N -90 630 -90 670 {
lab=#net1}
N -90 630 0 630 {
lab=#net1}
N -120 510 -80 510 {
lab=voutp}
N -120 550 -80 550 {
lab=voutn}
N 690 160 730 160 {
lab=voutp1}
N 690 200 730 200 {
lab=voutn1}
N 790 160 820 160 {
lab=vcm}
N 820 160 820 200 {
lab=vcm}
N 790 200 820 200 {
lab=vcm}
N 820 180 840 180 {
lab=vcm}
N 850 320 850 340 {
lab=GND}
N 780 270 810 270 {
lab=#net4}
N 780 310 810 310 {
lab=#net5}
N 850 240 850 260 {
lab=iout1}
N 780 390 780 410 {
lab=GND}
N 780 310 780 330 {
lab=#net5}
N 690 390 690 410 {
lab=GND}
N 690 310 690 330 {
lab=#net4}
N 690 270 690 310 {
lab=#net4}
N 690 270 780 270 {
lab=#net4}
N 450 70 550 70 {
lab=voutp1}
N 490 70 490 90 {
lab=voutp1}
N 450 300 550 300 {
lab=voutn1}
N 490 270 490 300 {
lab=voutn1}
N 490 150 490 210 {
lab=sense1}
N 430 180 490 180 {
lab=sense1}
N 490 180 530 180 {
lab=sense1}
N 130 70 190 70 {
lab=voutp1}
N 140 300 200 300 {
lab=voutn1}
N -20 180 10 180 {
lab=GND}
N 70 180 120 180 {
lab=#net3}
N -190 190 -170 190 {
lab=vcmi}
N -260 530 -240 530 {
lab=vcmi}
N -260 -90 -220 -90 {
lab=vip}
N -260 -50 -220 -50 {
lab=vin}
N -180 -40 -180 -20 {
lab=#net6}
N -180 -20 -30 -20 {
lab=#net6}
N -180 -120 -180 -100 {
lab=#net7}
N -180 -120 -30 -120 {
lab=#net7}
N -90 -120 -90 -100 {
lab=#net7}
N -90 -40 -90 -20 {
lab=#net6}
N -30 -120 -30 -100 {
lab=#net7}
N -30 -40 -30 -20 {
lab=#net6}
N 40 -100 40 -40 {
lab=#net8}
N -30 -20 -30 20 {
lab=#net6}
N -30 20 30 20 {
lab=#net6}
N 30 20 40 20 {
lab=#net6}
N -30 -160 -30 -120 {
lab=#net7}
N -30 -160 40 -160 {
lab=#net7}
N 40 -70 60 -70 {
lab=#net8}
C {devices/vsource.sym} -590 190 0 0 {name=V2 value=0.25
}
C {devices/vcvs.sym} -520 50 0 0 {name=E1 value=-0.5}
C {devices/vcvs.sym} -660 50 0 1 {name=E2 value=0.5}
C {devices/vsource.sym} -590 60 0 0 {name=VIN value="0 AC 1"
}
C {devices/gnd.sym} -590 250 0 0 {name=l1 lab=GND}
C {devices/lab_pin.sym} -680 0 0 0 {name=l1 sig_type=std_logic lab=vip}
C {devices/lab_pin.sym} -500 0 0 1 {name=l1 sig_type=std_logic lab=vin
}
C {devices/lab_pin.sym} -660 130 0 0 {name=l8 sig_type=std_logic lab=vcmi}
C {devices/launcher.sym} -760 520 0 0 {name=h1
descr="Annotate OP"
tclcommand="set show_hidden_texts 1; xschem annotate_op"}
C {sky130_fd_pr/corner.sym} -670 360 0 0 {name=CORNER only_toplevel=false corner=tt}
C {devices/lab_pin.sym} -590 30 1 0 {name=l1 sig_type=std_logic lab=vid}
C {devices/vcvs.sym} 70 650 0 0 {name=E7 value=1}
C {devices/lab_pin.sym} 70 600 0 1 {name=l2 sig_type=std_logic lab=iout}
C {devices/gnd.sym} -590 100 0 0 {name=l1 lab=GND}
C {devices/code.sym} -800 360 0 0 {name=STIMULI
only_toplevel=false
value="
.options savecurrents
.control
save all

let f_sig = 18
let tper_sig = 1/f_sig
let tfr_sig = tper_sig/2
*alter @VIN[PULSE]=[ -0.8 0.8 0 $&tfr_sig $&tfr_sig 1u $&tper_sig 0 ]
alter @VIN[SIN] = [ 0 0.1 $&f_sig 0 0 0 ]
alter @VIN[DC] = 0.0

let tstep = 0.01/f_sig
let tstop = 100/f_sig
let tstart = 0

** Main Simulations
let rl = 1Meg
let pltnr = 1
.options scale = 1
while const.pltnr le 1
	
	dc VIN -0.81 0.81 0.008

	ac dec 1000 0.1 1e9

	tran $&tstep $&tstop $&tstart

	
	set pltName = "ac$&const.pltnr"
       	setplot $pltName
	*setplot ac1
	let A_cell = v(iout)/v(vid)
	plot vdb(A_cell) 180/PI*cph(A_cell)
	let A1 = v(iout1)/v(vid)
	plot vdb(A1) 180/PI*cph(A1)

	set pltName = "dc$&const.pltnr"
       	setplot $pltName
	*setplot dc1
	let vid = v(vid)

	
	*let iop = v1#branch
	*let ion = v3#branch
	*let iod = iop-ion

	*plot iod ion iop

	setplot tran1
	let vcmo_cell = (voutp+voutn)/2
	let vcmo_1 = (voutp1+voutn1)/2
	let iop_cell = vop#branch
	let ion_cell = von#branch
	let iop_1 = vop1#branch
	let ion_1 = von1#branch
	let io_diff_cell = vop#branch - von#branch
	let io_diff_1 = vop1#branch - von1#branch
	let gm_cell = abs(io_diff_cell+1e-15)/abs(vid+1e-15)
	let gm_1 = abs(io_diff_1+1e-15)/abs(vid+1e-15)
	plot vcmo_cell vcmo_1
	plot io_diff_cell io_diff_1
	plot gm_cell gm_1
	plot v(vid)
	plot iop_cell ion_cell
	plot iop_1 ion_1
	


       	let const.pltnr = const.pltnr + 1
end
op
remzerovec
write gm_c_ota_int_ideal.raw
.endc"}
C {devices/lab_pin.sym} 550 70 2 0 {name=l5 sig_type=std_logic lab=voutp1
}
C {devices/lab_pin.sym} 550 300 2 0 {name=l6 sig_type=std_logic lab=voutn1
}
C {devices/res.sym} 230 120 0 0 {name=R20
value=50Meg
footprint=1206
device=resistor
m=1}
C {devices/res.sym} 230 240 0 0 {name=R3
value=50Meg
footprint=1206
device=resistor
m=1}
C {devices/capa.sym} -170 140 0 0 {name=C5
m=1
value=0.1p
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} -170 240 2 0 {name=C3
m=1
value=0.1p
footprint=1206
device="ceramic capacitor"}
C {devices/gnd.sym} 70 700 0 0 {name=l7 lab=GND}
C {devices/vsource.sym} -740 190 0 0 {name=V3 value=0.9
}
C {devices/gnd.sym} -740 250 0 0 {name=l13 lab=GND}
C {devices/lab_pin.sym} -740 140 0 0 {name=l15 sig_type=std_logic lab=vcm}
C {devices/res.sym} -230 70 3 0 {name=R1
value=0
footprint=1206
device=resistor
m=1}
C {devices/res.sym} -230 300 3 0 {name=R2
value=0
footprint=1206
device=resistor
m=1}
C {devices/capa.sym} 330 240 2 0 {name=C1
m=1
value=1p
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} 330 120 0 0 {name=C2
m=1
value=1p
footprint=1206
device="ceramic capacitor"}
C {devices/lab_pin.sym} -260 570 0 0 {name=l3 sig_type=std_logic lab=vip}
C {devices/lab_pin.sym} -260 490 2 1 {name=l4 sig_type=std_logic lab=vin
}
C {devices/bsource.sym} 120 120 0 1 {name=B1 VAR=I FUNC=\{0.5u*tanh(0.5u*V(ip1,in1)/0.5u)\}}
C {devices/lab_pin.sym} -90 70 0 1 {name=p1 sig_type=std_logic lab=ip1}
C {devices/lab_pin.sym} -90 300 0 1 {name=p2 sig_type=std_logic lab=in1}
C {devices/bsource.sym} 120 240 0 1 {name=B2 VAR=I FUNC=\{0.5u*tanh(0.5u*V(ip1,in1)/0.5u)\}}
C {devices/res.sym} 430 120 0 0 {name=R4
value=1G
footprint=1206
device=resistor
m=1}
C {devices/res.sym} 430 240 0 0 {name=R5
value=1G
footprint=1206
device=resistor
m=1}
C {devices/lab_pin.sym} 530 180 0 1 {name=p3 sig_type=std_logic lab=sense1}
C {devices/vsource.sym} 130 510 3 0 {name=VOP value=0
}
C {devices/vsource.sym} 130 550 3 0 {name=VON value=0
}
C {devices/lab_pin.sym} -280 300 0 0 {name=l10 sig_type=std_logic lab=vip}
C {devices/lab_pin.sym} -280 70 2 1 {name=l12 sig_type=std_logic lab=vin
}
C {devices/lab_pin.sym} 60 510 2 1 {name=l16 sig_type=std_logic lab=voutp
}
C {devices/lab_pin.sym} 60 550 2 1 {name=l17 sig_type=std_logic lab=voutn
}
C {devices/gnd.sym} 0 770 0 0 {name=l18 lab=GND}
C {devices/ccvs.sym} 0 720 0 0 {name=H2 vnam=von value=1}
C {devices/gnd.sym} -90 770 0 0 {name=l20 lab=GND}
C {devices/ccvs.sym} -90 720 0 0 {name=H3 vnam=vop value=1}
C {devices/lab_pin.sym} -80 510 2 0 {name=l19 sig_type=std_logic lab=voutp
}
C {devices/lab_pin.sym} -80 550 2 0 {name=l21 sig_type=std_logic lab=voutn
}
C {devices/vsource.sym} 760 160 3 0 {name=VOP1 value=0
}
C {devices/vsource.sym} 760 200 3 0 {name=VON1 value=0
}
C {devices/lab_pin.sym} 840 180 0 1 {name=l9 sig_type=std_logic lab=vcm}
C {devices/lab_pin.sym} 690 160 2 1 {name=l14 sig_type=std_logic lab=voutp1
}
C {devices/lab_pin.sym} 690 200 2 1 {name=l22 sig_type=std_logic lab=voutn1
}
C {devices/vcvs.sym} 850 290 0 0 {name=E3 value=1}
C {devices/lab_pin.sym} 850 240 0 1 {name=l23 sig_type=std_logic lab=iout1}
C {devices/gnd.sym} 850 340 0 0 {name=l24 lab=GND}
C {devices/gnd.sym} 780 410 0 0 {name=l25 lab=GND}
C {devices/ccvs.sym} 780 360 0 0 {name=H4 vnam=von1 value=1}
C {devices/gnd.sym} 690 410 0 0 {name=l26 lab=GND}
C {devices/ccvs.sym} 690 360 0 0 {name=H5 vnam=vop1 value=1}
C {devices/capa.sym} 490 120 0 0 {name=C4
m=1
value=1p
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} 490 240 0 0 {name=C6
m=1
value=1p
footprint=1206
device="ceramic capacitor"}
C {devices/bsource.sym} 40 180 1 1 {name=B3 VAR=I FUNC=\{V(sense1)-0.9\}}
C {devices/gnd.sym} -20 180 1 0 {name=l27 lab=GND}
C {devices/lab_pin.sym} -190 190 0 0 {name=l28 sig_type=std_logic lab=vcmi}
C {devices/lab_pin.sym} -260 530 0 0 {name=l29 sig_type=std_logic lab=vcmi}
C {devices/lab_pin.sym} 210 530 0 1 {name=l11 sig_type=std_logic lab=vcm}
C {/foss/designs/macro-models/ota_fd_2pole.sym} -220 430 0 0 {name=x1 GM=1u RO=100Meg CO=1p RP=0 CP=0.1p VCMO=900m I0=1u}
C {devices/vcvs.sym} -180 -70 0 0 {name=E4 value=1}
C {devices/lab_pin.sym} -260 -50 2 1 {name=l30 sig_type=std_logic lab=vin
}
C {devices/lab_pin.sym} -260 -90 0 0 {name=l31 sig_type=std_logic lab=vip}
C {devices/capa.sym} -30 -70 0 0 {name=C7
m=1
value=0.1p
footprint=1206
device="ceramic capacitor"}
C {devices/res.sym} -90 -70 0 0 {name=R6
value=1G
footprint=1206
device=resistor
m=1}
C {devices/capa.sym} 40 -130 0 0 {name=C8
m=1
value=0.1p
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} 40 -10 2 0 {name=C9
m=1
value=0.1p
footprint=1206
device="ceramic capacitor"}
